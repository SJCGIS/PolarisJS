<!DOCTYPE html>
<html> 
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=7, IE=9, IE=10">
    <!--The viewport meta tag is used to improve the presentation and behavior of the samples 
    on iOS devices-->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">
    <title>Polaris - San Juan County WA</title>
    <link rel="stylesheet" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/js/dojo/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/js/esri/css/esri.css">

    <style>
    html, body {
      height:100%;
      width:100%;
      margin:0;
      padding:0;
    }
    #borderContainerTwo {
      width:100%;
      height:100%;
    }
    #map {
      height:100%;
      width:100%;
      overflow:hidden;
    }
    #rightPane {
      width: 175px;
      margin: 0;
      padding: 0;
    }
    #paneHeader {
      background: url(images/header.png) repeat-x;
      color: white;
      border-bottom: solid 1px #B5BCC7;
      text-align: center;
      height: 30px;
      margin: 0;
      overflow: hidden;
      font-size: 16px;
      padding: 8px 5px;
    }
    .esriLegendServiceLabel {
      display:none;
    }

    </style>

    <script>var dojoConfig = {
      parseOnLoad: true,
      packages: [{
        "name":"agsjs",
        "location": "/GISApps/2.03/agsjs/src/agsjs"
      }]
    }
    </script>
    <script src="http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/"></script>
    <script>  

    dojo.require("esri.map");
    dojo.require("esri.arcgis.utils");
    dojo.require("esri.dijit.Popup");
    dojo.require("esri.dijit.BasemapGallery");
    dojo.require("esri.dijit.Legend");
    dojo.require("esri.dijit.OverviewMap");
    dojo.require("dijit.layout.ContentPane");
    dojo.require("dijit.layout.BorderContainer");
    dojo.require("dijit.layout.AccordionContainer");
    dojo.require("dijit.layout.AccordionPane");
    dojo.require("dijit.layout.TabContainer");
    dojo.require("dijit.layout.LayoutContainer");
    dojo.require("dijit.form.Button");
    dojo.require("agsjs.dijit.TOC");
    
    var map;
    function init() {
      var mapDeferred = esri.arcgis.utils.createMap("15f2060ce9cc476c8156c5be5bea4726", "map", {
        geometryServiceURL: "http://www.sjcgis.org/Polaris/rest/services/Geometry/GeometryServer"
      });
      mapDeferred.then(function(response) {
        console.log(response.itemInfo.item.title);
        map = response.map;
        var layers = response.itemInfo.itemData.operationalLayers;
        var layerInfo = dojo.map(layers, function(layer,index) {
          return {layer:layer.layerObject,title:layer.title};
        });
        
        dojo.connect(map,"onLayersAddResult",function(results){
          var toc = new agsjs.dijit.TOC({
            map: map,
            layerInfos: layerInfo
          }, "legend");
          toc.startup();
        });

        var overviewMap = new esri.dijit.OverviewMap({
          map: map
        }, dojo.byId("overviewMap"));
        overviewMap.startup();
      },function(error) {
          console.log("Map creation failed: ", error);
        });
      }

      dojo.ready(init);
    </script>
  </head>
  
  <body class="claro">
    <div id="borderContainerTwo" data-dojo-type="dijit.layout.BorderContainer"
         data-dojo-props="gutters:true, liveSplitters:false">
      <div id="topPane" data-dojo-type="dijit.layout.ContentPane" 
           data-dojo-props="region:'top', splitter:false">
        <h1>Polaris</h1>
      </div>
      <div id="map" data-dojo-type="dijit.layout.ContentPane"
           data-dojo-props="region:'center'">
      </div>
      <div data-dojo-type="dijit.layout.AccordionContainer"
           data-dojo-props="minSize:20, region:'leading', splitter:true"
           style="width:400px;" id="leftAccordion">
        <div data-dojo-type="dijit.layout.AccordionPane" title="Legend" selected="true">
          <div data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region:'center'">
            <div id="legend"></div>
          </div>
        </div>
        <div data-dojo-type="dijit.layout.AccordionPane" title="Overview Map">
          <div data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region: 'center'">
            <div id="overviewMap"></div>
          </div>
        </div>
        <div data-dojo-type="dijit.layout.AccordionPane" title="Saved Maps">
        </div>
      </div>
    </div>
  </body>
</html>
